# ECMAScript: Начало. История и спецификация

---
[Ссылка не презентацию](https://docs.google.com/presentation/d/1WX7hMqyRU6K3X5dvze9qdX1xq5e_iTTCnkmp6qvVlWA/edit?usp=sharing)

## Содержание

### Часть I
- Происхождение и история создания
- Ранние версии

### Часть II
- Скандалы, интриги и версии 3.1 и 4
- Развитие
- ECMAScript сейчас
---

## Часть I
### Вступительное слово

Зачем этот доклад?

В наше время принято ругать JavaScript практически за все, что в нем есть. Доходит до того, что разработчиков на JS не хотят называть программистами. Но если посмотреть на контекст в котором разрабатывался язык и узнать историю людей причастных к его разрабоке, то многое становится понятным. В этом докладе нет попытки изменить ваше мнение о JS, но есть попытка объяснить почему язык стал таким, каким мы его видим сейчас.

Помимо этой цели доклад преследует и другую. Разбираясь в истории других разработчиков их проблем и решений мы можем примерить на себя ситуации в которых они оказывались, провести параллели со своей собственной работой и, возможно, найти ответы на вопросы которые актуальны именно для нас. Ведь история циклична и то, с чем сталкивались предыдущие инженеры рано или поздно в некотором изменненом виде предстоит и нам.

И, конечно, доклад направлен на расширение кругозора. Любоптство, подвижный ум и интерес это важные профессиональные качества для любого разработчика. Автор надеется, что эта небольшая история вдохновит кого-то на более углубленное изучение вопроса и расширит область знаний об истории инструметов, которыми пользуемся мы все.

### Происхождение и история создания

#### Что такое ECMA?

Прежде чем говорить непосредственно об ECMAScript стоит разобраться, окуда взялось название. И если со Script все понятно, то вот что такое ECMA - для многих остается загадкой.

> Как выдумаете, что значит ECMA?

Для ответа на этот вопрос пернесемся в 1959 год. Это, конечно, не год создания языка о котором мы сегодня говорим. Однако, это год когда растущее использование компьютеров производимых несколькими различными производителями привело к пониманию, что требуется создать некие стандарты по технологии их использвания. Такие, как стандарты программирования и кода ввода вывода.

Зачем нужны стандарты, когда у вас есть несколько разных производителей железа, думаю, объяснять не требуется. Уточню только, что разные страны имели разные запросы для своего железа и стандраты не обязательно должны быть едиными для всех стран. Однако, они должны быть как минимум совместимыми.

Итак, в 1960 году всем изестным на тот момент производителям железа были разосланы приглашения прислать своих представителей на встречу, которая прошла 27 апреля 1960 года в Брюсселе. Итогом этой встречи стало решение о создании европейской ассоциации производетелей компьютеров, а в оригинале: **European Computer Manufacturers Association (ECMA)**.

К декабрю 1960 года была описана форма, которую должна принять ECMA, а так же определено, что штаб-квартира ассоциации будет размещена в Женеве. Такое решение было принято в связи с тем, что в Женеве уже размещались штаб-квартиры организаций отвечающих за создание стандартов. Такие как:
- IEC - International Electrotechnical Commission
- ISO - International Organization for Standardization
- ITU - International Telecommunication Union

> Знакомы ли вам некторые аббревиатуры?

В последующие годы президентами ECMA становились сотрудники IBM, Intel, Xerox, Microsoft, Philips, HP, Hitachi и других. На момент нашей лекции президентом является представитель IBM Jochen Friedrich.

В 1994 году ассоциая была переименована в Ecma International – European association for standardizing information and communication systems. И хотя орагнизация стала глобальной аббревиатуру ECMA оставили в названии т.к. она уже стала в некотором роде "торговой маркой" ассоциации.

https://ecma-international.org/about-ecma/history/

#### Что такое ECMAScript, JavaScript, JScript?

Теперь мы знаем, что значит ECMA, но это значение довольно далеко от языков программирования. Откуда взялся ECMAScript и как он связан с JavaScript? И что такое JScript?

> Есть ли у вас предположения?

Для ответа на эти вопросы, нам снова нужно отправиться в прошлое.

Спустя примерно год после основания ECMA, в штате Пенсильвания, в городе Питсбург родился Брендан Айк и он во многом является причиной по которой мы все здесь сегодня собрались. Брендан закончил Santa Clara University со степенью бакалавра по математике и компьютерным наукам и получил степень магистра в University of Illinois at Urbana–Champaign.

После получения образования он 7 лет проработак в компании Silicon Graphics в качестве разработчки операционных систем и сетового взаимодействия. Коллеги говорят о нем, как о классическом инженере с острым умом, немного замкнутом, но очень ответственном человеке.

Нас интересует то, чем Брендан начал заниматься в 1995 году в компании NCC (Netscape Communications Corporation). Сам он планировал, что будет внедрять язык Scheme (один из диалектов Lisp созданный в 1970 году в MIT) в брузер Netscape Navigator. Но руководители из Netscape настояли, что синтаксис должен быть унаследован от активно развивашегося в те годы языка Java. В результате Айк разработал язык, который обладал большей частью функциональности Scheme, объектной ориентацией Self (диалект SmallTalk, который релизовывал концепцию прототипов) и синтаксисом Java. Причем первую версию нового языка Айк написал за 10 дней. Т.к. стояла задача уложиться к релизу бета-версии Navigator 2.0.

> Почему решили написать новый язык? Почему так торопились?

Забавным фактом о котором Айк упоминает в интервью является то, что первый код был написан в блоке комментариев прямо в HTML. К тому же компилятор не умел подключать файлы JS отдельно, поэтому сам код можно было писать толко inline.

Сначала язык назвали Mocha, в сенятбре 1995 его переименовали в LiveScipt, но уже в декабре в совместном объявлении с Sun Microsystems он был назван JavaScript. Так же для нового языка Брендан Айк разработал первый движок - SpiderMonkey.

Итак, официальной датой рождения JavaScript можно назвать декабрь 1995 года. Язык приобрел огромную популярность из-за низкого порога вхождения и уже в ноябре 1996, то есть примерно через год, ECMA, которая к тому моменту уже стала глобальной ассоциацией начинает разработку стандарта ESCMAScript Language Specification. Ныне известную как ECMA-262. 

Первая версия стандарта была принята генеральной ассамблеей ECMA в июне 1997 года. А в апреле 1998 этот стандарт был утвержден в качесте международного под кодом ISO/IEC 16262.

В 1998 Mozilla унаследовала код Netscape вместе с движоком SpiderMonkey, написанном на C. Однако с релизом JavaScipt 1.5 движок был переработан, для соответствия вышедшей ранее спецификации ECMA-262.

Параллельно с этим Microsoft разрабатывает JScript, который также реализует спецификацию ECMA-262, но помимо использовния в браузере, может выполняться и в среде Windows.

Таким образом JavaScript и JScript являются реализациями языка ECMAScript по спецификации ECMA-262 и международному стандарту ISO/IEC 16262. Разрабатываемый командой TC39 входящей в состав организации ECMA International.

TC39 в свою очередь делится на несколько групп:
TC39-TG1 General ECMAScript language
TC39-TG2 ECMAScript internationalization API specification
TC39-TG3 Security
TC39-TG4 Source map specification
TC39-TG5 Experiments in programming language standardization

### История развития

Не будем подробно останавливаться на всех версия стандарта. Об этом можно почитать на соответствующих ресурсах. Пройдемся только по основным моментам и датам.

#### ECMAScript 3

После релиза первой версии ECMA-262 JavaScipt был доработан в версии 1.5 чтобы точно сооответствовать спецификации, а сама спецификация была доработана чтобы соответсвовать стандарту ISO/IEC 16262 и новой версии JavaScript. Когда эта работа была закончена в июне 1998 года, вышла вторая версия стандарта: ECMAScript 2. Она включала только редакционные правки. Никаких новых функций и возможностей языка представленно не было.

> На тот момент исключения ещё не были частью языка JS и обработкой ошибок занимался компилятор.

В декабря 1999 года, то есть спустя полтора года с релиза второй версии принимается стандарт ECMAScript 3. Вносящий довольно большие улучшения в язык:
 - Регулярные выражения
 - Блок do-while
 - Исключения и try/catch блоки
 - Больше встроенных функций для строк и массивов
 - Форматирование численных выходных данных
 - Операторы in и instanceof
 - Улучшенная обработка ошибок


Немного отходя в сторону стоит умомянуть, что именно в годы этой версии JS появляется технология AJAX (asynchronous JavaScript and XML). Хоть она и не являлась частью стандарта, Microsoft встроила некоторые расширения для JavaScript в Internet Explorer 5. Одним из таких расширений была функция XMLHttpRequest в виде управляющего элемента ActiveX XMLHTTP. Эта функция позволяла браузеру выполнять асинхронные HTTP-запросы серверу, тем самым позволяя страницам обновляться на лету. Хотя само название AJAX было придумано значительно позже, сама техника активно использовалась в то время.

Применение XMLHttpRequest оказалось успешным, и годами позже было стандартизировано группами WHATWG и W3C.

Здесь же начинает проявлять характер Microsoft. Со своим IE 5, релизовывая не указанные в стандарте функции, например:

```JS
// ActiveXObject - это плагин Java, релизованный в Windows
var xhr = new ActiveXObject("Microsoft.XMLHTTP");
```

Некоторые проблемы с IE5 и последующими версиями начались именно здесь. Заставляя разработчиков писать отдельный код специально под IE.

#### ECMAScript 3.1 / 4

К началу разработки 4 версии языка, которая стартовала в 1999 году, вскоре после принятия третей версии, в сообществе назрел конфликт. JavaScript уже завоевал свою нишу. Его поддерживали все популярные браузеры и у него уже не было конкурентов. Часть разработчиков хотела продолжить экспоненциальное развитие языка и добавить в 4 версию еще больше улучшений и вывести JS на уровень крупных языков общего назначения для разработки больших приложений.

Вот лишь часть изменений которые предлагалось внести:
 - Классы
 - Интерфейсы
 - Пространства имён
 - Пакеты
 - Опциональные аннотации типов
 - Опциональная статическая проверка типов
 - Структурные типы
 - Объявления типов
 - Мультиметоды (узнать)
 - Параметризованные типы
 - Хвостовые рекурсии
 - Итераторы
 - Генераторы
 - Интроспекция
 - Разбор типа для обработчиков исключений
 - Связывание констант
 - Правильный обзор блоков
 - Деструктуризация
 - Сжатые функциональные выражения
 - Поддержка массивов

Опуская детали конфликта скажем, что в какой-то момент разработка стандарта остановилась вовсе, а потом начала вестись параллельно для двух стандартов: прогресивного четвертого и консерватинвного 3.1. В итоге победила более консервативная сторона, предложившая внести ограниченные изменения, не затрагивающие синтаксис. Только практичные улучшения, основанные на опыте использования языка.

Этот план развития стал носить неофициальное название Harmony (Гармония). Это слово использовал Брендан Айк в письме о принятых решениях по результатам переговоров.

Однако, на споры и согласования ушло почти 10 лет и новый стандарт был утвержден ECMA только в 2009 году.

#### Microsoft, Adobe, Flash и ActionScript

В 2003 году, когда разработка стандарта 4 зашла в тупик и практически остановилась был выпущен промежуточный отчет , и некоторые разработчики, такие, как Adobe (ActionScript) и Microsoft (JScript.NET) использовали его в качестве основы для собственных движков.

Adobe включил ActionScript в состав пакета инструментов для Flash-разработки, и это был единственный скриптовый язык, поддерживаемый этим пакетом.

Разработчики ActionScript надеялись, что нововведения, использованные в этом языке, станут впоследствии частью ECMAScript. К сожалению, никто не обратил на них никакого внимания и ECMAScript 2015 был в большинстве своем несовместим с ActionScript.

Microsoft же напротив блокировала все проекты ES4 и наотрез отказывалась принимать стандарт. Хотя сам JScript.NET на тот момент сильно отличался даже от 3 версии.

Так или иначе ActionScript так и остался языком для Flash и умер вместе с ним. В данный момент ActionScript можно использовать как исторический пример того, как мог бы выглядеть ECMAScript4 если бы победила прогрессивная команда:

```JS
package {
    import flash.display.Sprite;
    public class MyRectangle_v3 extends Sprite {
        private var _outlineWeight:Number;
        private var _color:uint;
        private var _xLocation:int;
        private var _yLocation:int;
        private var _rectangleWidth:int;
        private var _rectangleHeight:int;

        public function MyRectangle_v3(outlineWeight:Number, color:uint, 
                                       xLocation:int, yLocation:int, 
                                       rectangleWidth:int, rectangleHeight:int) {            
            _outlineWeight = outlineWeight;
            _color = color;
            _xLocation = xLocation;
            _yLocation = yLocation;
            _rectangleWidth = rectangleWidth;
            _rectangleHeight = rectangleHeight;
        }  

        public function draw():void{
            graphics.lineStyle(_outlineWeight);
            graphics.beginFill(_color);
            graphics.drawRect(_xLocation, _yLocation, _rectangleWidth, _rectangleHeight);
            graphics.endFill();
        }  
    }  
}
```

#### ECMAScript 5

 Чтобы исключить недопонимание внутри сообщества решено было пропустить цифру 4 переименовав 3.1 в 5. Поэтому В декабре 2009 года был официально выпушен стандарт ECMAScript 5. В него вошли следующие изменения:
 
- Геттеры/сеттеры
- Разделители-запятые в массивах и объектах
- Возможность использовать зарезервированные слова в качестве свойств объекта
- Новые методы объектов (create, defineProperty, keys, seal, freeze, getOwnPropertyNames и т.д.)
- Новые методы массивов (isArray, indexOf, every, some, map, filter, reduce и т.д.)
- String.prototype.trim и доступ к свойствам
- Новые методы Date (toISOString, now, toJSON)
- Привязывание функций
- JSON
- Неизменяемые глобальные объекты (undefined, NaN, Infinity)
- Строгий режим
- Другие небольшие изменения (parseInt игнорирует ведущие нули, функции в throw имеют значение и т.д.)

ECMAScript 5 получил обновление в 2011 году под названием ECMAScript 5.1. Этот релиз вносил ясность в некоторые неоднозначные пункты стандарта, но никаких новых возможностей в нем не было. Все новые возможности были запланированы для следующего большого релиза ECMAScript.


#### ECMAScript 6 (2015) и 7 (2016)

Стандарт ECMAScript 6 был позже переименован в ECMAScript 2015, с тех пор пошло правило именовать стандарт по году выпуска.
На момент релиза болшинство браузеров уже вели работу по реализации стандарта, на сегодняшний день это самая стабильная версия JS и многие бандлеры/транспайлеры используют ее, как версию сборки по умолчанию.

Некоторые изменения планировавшиеся в ECMAScript 4 вошли в эту версию.

Из основных изменений:
 - let (лексическая) и const (неизменяемая) привязки
 - Стрелочные функции (короткие анонимные функции) и лексическое this
 - Классы (синтаксический сахар поверх прототипов)
 - Улучшения объектных литералов (вычисляемые ключи, укороченные определения методов и т.д.)
 - Шаблонные строки
 - Промисы
 - Генераторы, итерируемые объекты, итераторы и for..of
 - Параметры функций по умолчанию и оператор rest
 - Spread-синтакис
 - Деструктуризация
 - Модульный синтаксис
 - Новые коллекции (Set, Map, WeakSet, WeakMap)
 - Proxy и Reflect
 - Тип данных Symbols
 - Типизированные массивы
 - Наследование классов
 - Оптимизация хвостовой рекурсии (что такое хвостовая рекурсия)
 - Упрощённая поддержка Unicode
 - Двоичные и восьмеричные литералы

Работа над ECMAScript 2015 была очень тяжёлой и заняла почти шесть лет (и даже больше, учитывая время, необходимое на реализацию).

Версия следующего года ECMAScript 2016 была по сути небольшим обновлением и включала в себя:
 - Оператор возведения в степень (**)
 - Array.prototype.includes
 - Несколько незначительных поправок (генераторы не могут быть использованы с new и т.д.)

### ECMAScript 20XX

После разрешения конфликтов и выбора направления развития, обновления для языка стали выходить регулярно. Далее просто перечислим нововедения принимавшиеся в последующих версиях:

#### 2017 (8 издание)

В ECMAScript 2017 представлены:
 - Асинхронные функции
 - Shared Memory (уточнить)
 - Atomics (уточнить)
 - новые статические методы для Object: Object.values, Object.entries, Object.getOwnPropertyDescriptors.

 Shared Memory и Atomics представляют новую модель памяти, которая позволяет мультиагентным программам взаимодействовать с использованием атомарных операций, которые обеспечивают четко определенный порядок выполнения даже на параллельных процессорах.

#### 2018 (9 издание)

В ECMAScript 2018 появились:
 - поддержка асинхронной итерации через протокол AsyncIterator
 - Асинхронные генераторы
 - Четыре новые функции regexp: dotAll, named capture groups, экранирование свойств Unicode и look-behind
 - Rest и Spread свойства объекта

#### 2019 (10 издание)

 - Flat и FlatMap в Array.prototype
 - Object.fromEntries
 - TrimStart и TrimEnd в String.prototype
 - Требование к Array.prototype.sort, как к стабильной сортировке
 - Требование к JSON.stringify чтобы он возвращал правильно сформированный UTF-8 независимо от входных данных
 - Уточнение Function.prototype.toString, требующее, чтобы он либо возвращал соответствующий исходный исходный текст, либо стандартный заполнитель


#### 2020 (11 издание)

- matchAll для regexp
- import()
- BigInt
- Promise.allSettled
- globalThis
- Специальный экспорт `*`
- Повышенная стандартизация порядка перечисления for-in;
- import.meta
- nullish coalescing (`??`, `||`)
- optional chaining (`.?`)

#### 2021 (12 издание)

- replaceAll для строк;
- Promise.any
- AggregateError
- Операторы присваивания (??=, &&=, ||=)
- WeakRef
- FinalizationRegistry
- Разделители числовых литералов (1_000)
- Уточненный Array.prototype.sort

#### 2022 (13 издание)

- top-level Await
- Публичные и частные поля экземпляра
- Публичные и частные статические поля
- Частные методы и методы доступа экземпляра
- Частные статические методы и методы доступа
- Статические блоки внутри классов
- Синтаксис #x в obj для проверки наличия частных полей в объектах
- Индексы соответствия регулярных выражений через флаг /d
- Свойство причины объектов Error
- Метод at для строк, массивов и типизированных массивов
- Object.hasOwn - альтернатива Object.prototype.hasOwnProperty

#### 2023 (14 издание)

- toSorted, toReversed, toSpliced, with, findLast и findLastIndex в Array.prototype
- TypedArray.prototype
- Поддержка `#!` комментария в начале файла для облегчения работы с исполняемыми файлами ECMAScript

Вопросы:

Подробней про Flash и ActiveX
Осветить войну браузеров
Почему JavaScript такой какой он есть, к чему приводит гонка?
Почему JavaScript самый популярный язык в мире?
Зачем появилось JQuery?
Зачем появились фреймворки?