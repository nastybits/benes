# Утилита для тестов производительности ECMAScript

## Описание
Standalone утилита для многократного запуска js файлов и вывода результатов запусков в консоль. Используется для сравнения производительности различных функций и ES-движков. Для подключения движков используется [JSVU](https://github.com/GoogleChromeLabs/jsvu). Для запуска тестирования используется [nodeJS](https://nodejs.org/en) 18+

Тесты запускаются без обвязки nodeJS или браузера на условно "чистом" движке, что позволяет снизить влияние среды на скорость выполнения.

Для запуска тестов необходимо создать папку в директории `/tests`. В папке создать нужное количество тестируемых `.js` файлов.

__Итогом теста должен быть вывод времени выполнения в консоль в милисекундах.__

Пример файла теста:
```JS
// Путь: /tests/arrayFilterElement/byFilter.js

function arrFilter(arr, id) {
  return arr.filter(el => el.ID !== id)
}

var arr = []
for (let i = 0; i <= 10; i++) {
  arr.push({ ID: i })
}

var start = performance.now()
var r = arrFilter(arr, 5)

// Вывод времени выполнения в консоль
console.log(performance.now() - start)
```

Пример команды и результата выводимого в консоль
```bash
node ./bench ./tests/arrayFilterElement
byFilter: 100% (100/100)
┌──────────┬─────────┬────────┐
│ (index)  │ Average │ Delta  │
├──────────┼─────────┼────────┤
│ byFilter │ 0.1508  │ 0.1133 │
└──────────┴─────────┴────────┘
```
## Установка
После установки nodeJS 18+ необходимо установить JSVU глобально.
```bash
npm install jsvu -g
```
Добавить в переменную среды:
#### Linux/Mac:
```bash
export PATH="${HOME}/.jsvu/bin:${PATH}"
```

#### Windows:
Добавить папку `C:\Users\%USERNAME%\.jsvu\bin` в переменную среды `PATH`.

Запустить установщик:
```bash
 jsvu
```
Пройти интерактивный диалог для установки нужных движков.

Клонировать репозиторий в нужную папку:
```bash
git clone https://github.com/nastybits/js-perfomance-tests.git
```

## Тестирование производительности
Для запуска тестов используется nodeJS. Необходимо указать исполняемый файл теста и опциональные флаги дополнительных настроек.

```bash
node ./bench <dir> [-h] [-e S] [-r N] [-p N] [-a]
```

Параметры запуска:
```bash
dir             # Дирректория с файлами тестов
-h, --help      # Вывести описание
-e, --engine    # Имя JS-движока для запуска тестов
-r, --runs      # Количество прогонов
-p, --precision # Число знаков после запятой при выводе времени прогона
-a, --all       # Показывать детальную информацию по каждому прогону
```

Пример:
```bash
node ./bench tests/arrayItemCount -e v8 -r 10 -p 5 -a
```

Результаты сортируются по наименьшему времени выполнения.

## Дополнительно
### Просмотр байткода (Только V8):

Если в проекте подключен V8, то можно вывести байт-код любого файла или функции для анализа.

```bash
# Вывести байткод файла в консоль
v8 --print-bytecode <file>
```

### Фильтры
```bash
# Вывести байткод с фильтрацией
v8 --print-bytecode <file> --print-bytecode-filter=[param] 
```

Параметры фильтров:
- `*` - Вывести байткод для всего
- `""` - Вывести байткод только для кода в глобальной области
- `-` - Вывести байткод только для кода не в глобальной области
- `doSomething` - вывести байткод только для функции "doSomething"